<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/common :: head('게시판')"> </head>

<body class="bg-base-100">
<!-- 사이드바 -->
<!--<div th:replace="fragments/common :: category_sidebar"></div>-->

<!-- 상단 메뉴 -->
<nav th:replace="fragments/common :: menu(post)"></nav>

<div class="max-w-5xl mx-auto px-4 py-32">
    <h2 class="text-3xl font-bold mb-8">게시판</h2>

    <!-- 카드 목록 -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div th:each="post : ${posts}" class="card bg-base-200 shadow-sm rounded-xl">
            <figure>
                <img class="h-48 w-full object-cover"
                     src="https://coffective.com/wp-content/uploads/2018/06/default-featured-image.png.jpg">
            </figure>

            <div class="card-body">
                <h5 class="card-title text-xl font-semibold" th:text="${post.title}">Card title</h5>

                <a class="text-gray-600 line-clamp-3 hover:text-primary"
                   th:text="${post.content}"
                   th:href="@{/anthive/{member}/post/{post}(member=${post.member.email.address},post=${post.id})}">
                    text
                </a>

                <!-- 수정 / 삭제 버튼 -->
                <div class="flex justify-end gap-3"
                     th:classappend="${post.member.email.address != #authentication.name}? ' hidden'">
                    <a th:href="@{/anthive/form(postId=${post.id})}" class="text-primary hover:text-primary-focus">
                        <i data-lucide="pencil"></i>
                    </a>
                    <button type="button"
                            class="text-error hover:text-error-content"
                            th:onclick="|deletePost(${post.id})|">
                        <i data-lucide="trash-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 페이징 -->
    <div class="flex justify-center mt-10">
        <div class="join">
            <a class="join-item btn"
               th:classappend="${1 == startPage}? ' btn-disabled'"
               th:href="@{/anthive/{member}/catalog-list(page=${posts.pageable.pageNumber - 4},member=${#authentication.name})}">
                이전
            </a>

            <a th:each="i: ${#numbers.sequence(startPage, endPage)}"
               class="join-item btn"
               th:classappend="${i == posts.pageable.pageNumber + 1}? ' btn-active'"
               th:text="${i}"
               th:href="@{/anthive/{member}/catalog-list(page=${i},member=${#authentication.name})}">
            </a>

            <a class="join-item btn"
               th:classappend="${posts.totalPages == endPage || posts.totalPages == 0}? ' btn-disabled'"
               th:href="@{/anthive/${member}/catalog-list(member=${#authentication.name},page=(${posts.pageable.pageNumber + 6}>${posts.totalPages})? ${posts.totalPages} : ${posts.pageable.pageNumber + 6})}">
                다음
            </a>
        </div>
    </div>

    <!-- 글쓰기 버튼 -->
    <div class="mt-10 text-right">
        <a class="btn btn-primary" th:href="@{/anthive/form}">글 쓰기</a>
    </div>
</div>

<!-- lucide icons activate -->
<script>
    lucide.createIcons();
</script>

<script>
    // 글 내용 HTML 제거 (jQuery 제거)
    document.querySelectorAll(".card-text").forEach(el => {
        el.textContent = el.textContent.replace(/(<([^>]+)>)/ig, "");
    });

    // 삭제 요청
    function deletePost(id) {
        fetch('/api/post/' + id, {
            method: 'DELETE',
            headers: {
                "[[${_csrf.headerName}]]": "[[${_csrf.token}]]"
            }
        }).then(res => {
            if (res.ok) location.reload();
        });
    }
</script>

</body>
</html>
